{%- assign path = include.path | remove: ".jpg" | remove: ".jpeg" | remove: ".png" | remove: ".tiff" -%}

<figure {% if include.figure_class %}class="{{ include.figure_class }}" {% endif %}>

  <picture>
    {% for i in site.imagemagick.widths -%}
    <source media="(max-width: {{ i }}px)" srcset="{{ path | relative_url }}-{{ i }}.webp" />
    {% endfor -%}

    <!-- Fallback to the original file -->
    <!-- style="max-width:100%;max-height:100%" -->
    <img {% if include.img_class %}class="{{ include.img_class }}" {% endif %} src="{{ include.path | relative_url }}"
      {% if include.alt %}alt="{{ include.alt }}" {% endif %} {% if include.title %}title="{{ include.title }}" {% endif
      %} {% if include.zoomable %}data-zoomable{% endif %} {% if include.style %}style="{{ include.style }}" {% endif
      %} />

  </picture>

  {%- if include.caption -%}<figcaption class="caption">{{ include.caption }}</figcaption>{%- endif %}

</figure>